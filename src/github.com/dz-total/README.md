# Итоговое домашнее задание


[Вернуться на Главную страницу](../../../README.MD)

## Дисциплина
Программирование на Golang

## Итоговое домашнее задание

Цель — создать систему обработки транзакций. Это веб-приложение, разработанное для управления финансовыми операциями пользователя. Приложение позволяет клиентам создавать, просматривать, обновлять и удалять транзакции. Каждая транзакция включает информацию о сумме, валюте, типе (доход, расход, перевод), категории, дате и описании. Система также предоставляет интеграцию с внешними API для получения актуальных курсов валют и расчёта комиссий за транзакции.

## Описание реализации:

### Запуск автотестов

```
make test
# система запустит docker-compose и выполнит серию тестов
```

### Запуск и проверка работы приложения
```
# Запустить docker-compose и приложение на порту указанном в ./configs/config.yaml
make run

# Остановить/прервать выполнение приложения 
@Ctrl+C

# Остановить docker-compose
make stop

```

При запуске система создает файл `FinalTaskAppGoBasic.log`, в который записываются логи работы приложения. Настройка логирования выполняется с помощью изменения параметров в файле [logsetup.yaml](./configs/logsetup.yaml).

**Для проверки работы приложения можно использовать:**

1. [Postman коллекцию](./assets/GOLang-Transactions.postman_collection.json);
2. DBeaver, параметры [подключения к БД ](./configs/config.yaml).

### Использование POSTMAN коллекции

1. Импортировать коллекцию в Postman. Предустановленные параметры коллекции позволят автоматизировать большинство операций с запросами;
2. Запустить приложение с помощью команды `make run`;
3. Выполнить Запрос "0.User 1 Create" - система создаст Клиента. Проверка в таблице `users` Базы данных;
4. Выполнить Запрос "1.User 1 Auth" - в заголовках ответа система вернёт `JWT` токен, который автоматически запишется в параметр коллекции `TokenAuth`. Далее все запросы автоматически будут использовать его для авторизации;
5. Выполнить Запросы 2.1, 2.2*, предварительно проверив значение `user_id` (таблица `users` Базы данных);
6. Выполнить Запросы GET 3* .  При выполнении запроса конвертации Суммы в выбранную валюту необходимо проверить значение `transaction_id` (таблица `transactions` Базы данных);
7. Выполнить Запрос PUT 3 - проверить значение `transaction_id` (таблица `transactions` Базы данных);
8. Выполнить Запрос DELETE 5 - проверить значение `transaction_id` (таблица `transactions` Базы данных).

> **Важно:** Система по значению `TokenAuth` определяет `user_id` и выполняет изменения с Транзакциями только для этого значения `user_id`.

## Архитектура системы
Система состоит из нескольких компонентов:

    Сервис транзакций (домашнее задание 5).
    Требования к программе на этом этапе

    Обрабатывает HTTP-запросы от пользователя.
    Функциональность: создание, получение, обновление и удаление транзакций.
    Осуществляет поддержку разных типов транзакций: доходы, расходы, переводы и автоматический пересчёт сумм транзакций в предпочитаемую валюту пользователя с использованием актуальных курсов.

    База данных (PostgreSQL, домашнее задание 6).
    Требования к программе на этом этапе

    Используется структура для хранения данных о транзакциях: таблица транзакций (Transaction), в которой хранится информация о транзакциях пользователей.

    Сервис расчёта комиссий (домашнее задание 7).
    Требования к программе на этом этапе

    Рассчитывает комиссии за транзакции в зависимости от их типа и валюты.
    Функциональность: расчёт комиссий за переводы в зависимости от валюты и типа транзакции.

    Сервис курсов валют (домашнее задание 8).
    Требования к программе на этом этапе

    Взаимодействует с внешним API для получения актуальных курсов валют и предоставляет функционал для конвертации сумм транзакций в предпочитаемую валюту пользователя.
    Функциональность: расчёт комиссий за переводы в зависимости от валюты и типа транзакции.

    Тестирование кодовой базы.
    Требования к программе на этом этапе

    Написаны юнит-тесты для ключевых функций.
    Использованы моки для внешних зависимостей.
    Реализованы интеграционные тесты, проверяющие взаимодействие сервисов.
    Тесты покрывают обработку ошибок и исключительных ситуаций.

    Настройка логирования событий в системе обработки транзакций, включая сервис комиссий и сервис курса валют.

# Сценарий

Шаг 1. Интегрируйте библиотеку для логирования в ваш проект.
Например: logrus (go get github.com/sirupsen/logrus).

Шаг 2. Укажите формат вывода (например, JSON) и уровень логирования.
var log = logrus.New()
// Настройка формата логов
log.Formatter = &logrus.JSONFormatter{}
// Установка минимального уровня логирования
log.Level = logrus.InfoLevel

Шаг 3. Используйте разные уровни логирования — debug, info, warn, error, fatal — в зависимости от ситуации.

    Trace — самый подробный уровень, используется для отслеживания работы приложения на самом низком уровне.
    Debug — информация, предназначенная для разработчиков при отладке приложения.
    **Info — общие события, описывающие работу приложения.**
    Warn — предупреждения о потенциальных проблемах, которые не мешают работе приложения.
    Error — ошибки, влияющие на выполнение текущей операции, но не останавливающие приложение.
    Fatal — критические ошибки, приводящие к аварийному завершению работы приложения.
    Panic — сообщения, после которых приложение аварийно завершает работу с выводом стека вызовов.

Пример логирования Info 1:

```
log.WithFields(logrus.Fields{“module”: “moduleName”,“operation”: “operationName”,“details”: “Дополнительная информация”,}).Info(“Описание события”)
```

Пример лога Error 2:

```
logrus.WithFields(logrus.Fields{“module”: “exampleModule”,“operation”: “doSomething”,}).Errorf(“Произошла ошибка: %v”, err)
```

## Дополнительное задание: подключение метрик Prometheus.*

Это задание не оценивается, выполняется по желанию.
Шаг 1. Установка клиента Prometheus для Go.
go get github.com/prometheus/client_golang/prometheus
go get github.com/prometheus/client_golang/prometheus/promhttp
go get github.com/prometheus/client_golang/prometheus/promauto
Шаг 2. Создайте и зарегистрируйте метрики. С помощью promhttp.Handler() экспонируйте собранные метрики на эндпойнте /metrics.



Шаг 3. Чтобы Prometheus начал собирать метрики с вашего приложения, добавьте информацию о задаче сбора метрик (scrape_config) в конфигурационный файл Prometheus.

Шаг 4. Проверьте доступность веб-интерфейса Prometheus (обычно доступен по адресу http://localhost:8080) и используйте его для просмотра и анализа собранных метрик.

Пример вывода Prometheus:

```
http://localhost:8080/metrics

```

## Требования к системе в целом

### Функциональные требования:

    CRUD-операции для транзакций;
    автоматический пересчёт суммы транзакций в предпочитаемую валюту пользователя;
    расчёт комиссий в зависимости от типа транзакции;
    система должна быть разработана с учётом принципов модульности;
    система должна включать комплекс юнит- и интеграционных тестов, логирование ключевых событий в системе;
    сбор метрик работы системы (необязательно).
